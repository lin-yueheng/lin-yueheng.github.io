



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="диво" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="диво" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="диво" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  

<link rel="canonical" href="http://example.com/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/">



  <title>
cookie&session |
谷阿玛尼 = диво</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">cookie&session
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2022-12-15 11:52:14">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2022-12-15T11:52:14+08:00">2022-12-15</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>42k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>38 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">谷阿玛尼</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
          <img src="/assets/%E5%B1%B1%E9%A1%B6.jpg">
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://example.com/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="AMANI">
    <meta itemprop="description" content=", 在努力提升你喜欢我的概率，即使是从0开始！~~（@ @）~~">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="диво">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="会话技术"><a class="markdownIt-Anchor" href="#会话技术">#</a> 会话技术</h2>
<p><strong>今日目标</strong></p>
<blockquote>
<ul>
<li>
<p>理解什么是会话跟踪技术</p>
</li>
<li>
<p>掌握 Cookie 的使用</p>
</li>
<li>
<p>掌握 Session 的使用</p>
</li>
<li>
<p>完善用户登录注册案例的功能</p>
</li>
</ul>
</blockquote>
<h2 id="1会话跟踪技术的概述"><a class="markdownIt-Anchor" href="#1会话跟踪技术的概述">#</a> 1，会话跟踪技术的概述</h2>
<p>对于 <code>会话跟踪</code> 这四个词，我们需要拆开来进行解释，首先要理解什么是 <code>会话</code> ，然后再去理解什么是 <code>会话跟踪</code> :</p>
<ul>
<li>
<p>会话：用户打开浏览器，访问 web 服务器的资源，会话建立，直到有一方断开连接，会话结束。在一次会话中可以包含<mark>多次</mark>请求和响应。</p>
<ul>
<li>从浏览器发出请求到服务端响应数据给前端之后，一次会话 (在浏览器和服务器之间) 就被建立了</li>
<li>会话被建立后，如果浏览器或服务端都没有被关闭，则会话就会持续建立着</li>
<li>浏览器和服务器就可以继续使用该会话进行请求发送和响应，上述的整个过程就被称之为<mark>会话</mark>。</li>
</ul>
<p>用实际场景来理解下会话，比如在我们访问京东的时候，当打开浏览器进入京东首页后，浏览器和京东的服务器之间就建立了一次会话，后面的搜索商品，查看商品的详情，加入购物车等都是在这一次会话中完成。</p>
<p>思考：下图中总共建立了几个会话？</p>
<p><img data-src="assets/1629382713180.png" alt="1629382713180"></p>
<p>每个浏览器都会与服务端建立了一个会话，加起来总共是<mark> 3</mark> 个会话。</p>
</li>
<li>
<p>会话跟踪：一种维护浏览器状态的方法，服务器需要识别多次请求是否来自于同一浏览器，以便在同一次会话的多次请求间<mark>共享数据</mark>。</p>
<ul>
<li>服务器会收到多个请求，这多个请求可能来自多个浏览器，如上图中的 6 个请求来自 3 个浏览器</li>
<li>服务器需要用来识别请求是否来自同一个浏览器</li>
<li>服务器用来识别浏览器的过程，这个过程就是<mark>会话跟踪</mark></li>
<li>服务器识别浏览器后就可以在同一个会话中多次请求之间来共享数据</li>
</ul>
<p>那么我们又有一个问题需要思考，一个会话中的多次请求为什么要共享数据呢？有了这个数据共享功能后能实现哪些功能呢？</p>
<ul>
<li>
<p>购物车:  <code>加入购物车</code> 和 <code>去购物车结算</code> 是两次请求，但是后面这次请求要想展示前一次请求所添加的商品，就需要用到数据共享。</p>
<p><img data-src="assets/1629383655260.png" alt="1629383655260"></p>
</li>
<li>
<p>页面展示用户登录信息：很多网站，登录后访问多个功能发送多次请求后，浏览器上都会有当前登录用户的信息 [用户名]，比如百度、京东、码云等。</p>
<p><img data-src="assets/1629383767654.png" alt="1629383767654"></p>
</li>
<li>
<p>网站登录页面的 <code>记住我</code> 功能：当用户登录成功后，勾选 <code>记住我</code> 按钮后下次再登录的时候，网站就会自动填充用户名和密码，简化用户的登录操作，多次登录就会有多次请求，他们之间也涉及到共享数据</p>
<p><img data-src="assets/1629383921990.png" alt="1629383921990"></p>
</li>
<li>
<p>登录页面的验证码功能：生成验证码和输入验证码点击注册这也是两次请求，这两次请求的数据之间要进行对比，相同则允许注册，不同则拒绝注册，该功能的实现也需要在同一次会话中共享数据。</p>
<p><img data-src="assets/1629384004179.png" alt="1629384004179"></p>
</li>
</ul>
</li>
</ul>
<p>通过这几个例子的讲解，相信大家对 <code>会话追踪</code> 技术已经有了一定的理解，该技术在实际开发中也非常重要。那么接下来我们就需要去学习下 <code>会话跟踪</code> 技术，在学习这些技术之前，我们需要思考：为什么现在浏览器和服务器不支持数据共享呢？</p>
<ul>
<li>浏览器和服务器之间使用的是 HTTP 请求来进行数据传输</li>
<li>HTTP 协议是<mark>无状态</mark>的，每次浏览器向服务器请求时，服务器都会将该请求视为<mark>新的</mark>请求</li>
<li>HTTP 协议设计成无状态的目的是让每次请求之间相互独立，互不影响</li>
<li>请求与请求之间独立后，就无法实现多次请求之间的数据共享</li>
</ul>
<p>分析完具体的原因后，那么该如何实现会话跟踪技术呢？具体的实现方式有:</p>
<p>(1) 客户端会话跟踪技术：<mark>Cookie</mark></p>
<p>(2) 服务端会话跟踪技术：<mark>Session</mark></p>
<p>这两个技术都可以实现会话跟踪，它们之间最大的区别:<mark>Cookie 是存储在浏览器端而 Session 是存储在服务器端</mark></p>
<p>具体的学习思路为:</p>
<ul>
<li>CooKie 的基本使用、原理、使用细节</li>
<li>Session 的基本使用、原理、使用细节</li>
<li>Cookie 和 Session 的综合案例</li>
</ul>
<p><strong>小结</strong></p>
<p>在这节中，我们主要介绍了下什么是会话和会话跟踪技术，需要注意的是:</p>
<ul>
<li>HTTP 协议是无状态的，靠 HTTP 协议是无法实现会话跟踪</li>
<li>想要实现会话跟踪，就需要用到 Cookie 和 Session</li>
</ul>
<p>这个 Cookie 和 Session 具体该如何使用，接下来就先从 Cookie 来学起。</p>
<h2 id="2cookie"><a class="markdownIt-Anchor" href="#2cookie">#</a> 2，Cookie</h2>
<p>学习 Cookie，我们主要解决下面几个问题:</p>
<ul>
<li>什么是 Cookie?</li>
<li>Cookie 如何来使用？</li>
<li>Cookie 是如何实现的？</li>
<li>Cookie 的使用注意事项有哪些？</li>
</ul>
<h3 id="21-cookie的基本使用"><a class="markdownIt-Anchor" href="#21-cookie的基本使用">#</a> 2.1 Cookie 的基本使用</h3>
<p><strong>1. 概念</strong></p>
<p><mark>Cookie</mark>：客户端会话技术，将数据保存到客户端，以后每次请求都携带 Cookie 数据进行访问。</p>
<p><strong>2.Cookie 的工作流程</strong></p>
<p><img data-src="assets/1629386230207.png" alt="1629386230207"></p>
<ul>
<li>服务端提供了两个 Servlet，分别是 ServletA 和 ServletB</li>
<li>浏览器发送 HTTP 请求 1 给服务端，服务端 ServletA 接收请求并进行业务处理</li>
<li>服务端 ServletA 在处理的过程中可以创建一个 Cookie 对象并将 <code>name=zs</code>  的数据存入 Cookie</li>
<li>服务端 ServletA 在响应数据的时候，会把 Cookie 对象响应给浏览器</li>
<li>浏览器接收到响应数据，会把 Cookie 对象中的数据存储在浏览器内存中，此时浏览器和服务端就<mark>建立了一次会话</mark></li>
<li><mark>在同一次会话</mark>中浏览器再次发送 HTTP 请求 2 给服务端 ServletB，浏览器会携带 Cookie 对象中的所有数据</li>
<li>ServletB 接收到请求和数据后，就可以获取到存储在 Cookie 对象中的数据，这样同一个会话中的多次请求之间就实现了数据共享</li>
</ul>
<p><strong>3.Cookie 的基本使用</strong></p>
<p>对于 Cookie 的使用，我们更关注的应该是后台代码如何操作 Cookie，对于 Cookie 的操作主要分两大类，本别是<mark>发送 Cookie</mark> 和<mark>获取 Cookie</mark>, 对于上面这两块内容，分别该如何实现呢？</p>
<p>3.1 发送 Cookie</p>
<ul>
<li>创建 Cookie 对象，并设置数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookie = new Cookie(&quot;key&quot;,&quot;value&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>发送 Cookie 到客户端：使用<mark> response</mark> 对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>
<p>介绍完发送 Cookie 对应的步骤后，接下面通过一个案例来完成 Cookie 的发送，具体实现步骤为:</p>
<blockquote>
<p>需求：在 Servlet 中生成 Cookie 对象并存入数据，然后将数据发送给浏览器</p>
<p>1. 创建 Maven 项目，项目名称为 cookie-demo，并在 pom.xml 添加依赖</p>
<p>2. 编写 Servlet 类，名称为 AServlet</p>
<p>3. 在 AServlet 中创建 Cookie 对象，存入数据，发送给前端</p>
<p>4. 启动测试，在浏览器查看 Cookie 对象中的值</p>
</blockquote>
<p>(1) 创建 Maven 项目 cookie-demo，并在 pom.xml 添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jsp--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jstl--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(2) 编写 Servlet 类，名称为 AServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) 在 Servlet 中创建 Cookie 对象，存入数据，发送给前端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="comment">//1. 创建Cookie对象</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（4）启动测试，在浏览器查看 Cookie 对象中的值</p>
<p>访问 <code>http://localhost:8080/cookie-demo/aServlet</code></p>
<p>chrome 浏览器查看 Cookie 的值，有两种方式，分布式:</p>
<p>方式一:</p>
<p><img data-src="assets/1629389317463.png" alt="1629389317463"></p>
<p>方式二：选中打开开发者工具或者 使用快捷键 F12 或者 Ctrl+Shift+I</p>
<p><img data-src="assets/1629390237936.png" alt="1629390237936"></p>
<p>3.2 获取 Cookie</p>
<ul>
<li>获取客户端携带的所有 Cookie，使用<mark> request</mark> 对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie[] cookies = request.getCookies();</span><br></pre></td></tr></table></figure>
<ul>
<li>遍历数组，获取每一个 Cookie 对象：for</li>
<li>使用 Cookie 对象方法获取数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cookie.getName();</span><br><span class="line">cookie.getValue();</span><br></pre></td></tr></table></figure>
<p>介绍完获取 Cookie 对应的步骤后，接下面再通过一个案例来完成 Cookie 的获取，具体实现步骤为:</p>
<blockquote>
<p>需求：在 Servlet 中获取前一个案例存入在 Cookie 对象中的数据</p>
<p>1. 编写一个新 Servlet 类，名称为 BServlet</p>
<p>2. 在 BServlet 中使用 request 对象获取 Cookie 数组，遍历数组，从数据中获取指定名称对应的值</p>
<p>3. 启动测试，在控制台打印出获取的值</p>
</blockquote>
<p>(1) 编写一个新 Servlet 类，名称为 BServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/bServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）在 BServlet 中使用 request 对象获取 Cookie 数组，遍历数组，从数据中获取指定名称对应的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/bServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取Cookie</span></span><br><span class="line">        <span class="comment">//1. 获取Cookie数组</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="comment">//2. 遍历数组</span></span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="comment">//3. 获取数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cookie.getName();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;username&quot;</span>.equals(name))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cookie.getValue();</span><br><span class="line">                System.out.println(name+<span class="string">&quot;:&quot;</span>+value);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（3）启动测试，在控制台打印出获取的值</p>
<p>访问 <code>http://localhost:8080/cookie-demo/bServlet</code></p>
<p><img data-src="assets/1629391020081.png" alt="1629391020081"></p>
<p>在 IDEA 控制台就能看到输出的结果:</p>
<p><img data-src="assets/1629391061140.png" alt="1629391061140"></p>
<p>== 思考:== 测试的时候</p>
<ul>
<li>在访问 AServlet 和 BServlet 的中间把关闭浏览器，重启浏览器后访问 BServlet 能否获取到 Cookie 中的数据？</li>
</ul>
<p>这个问题，我们会在 Cookie 的使用细节中讲，大家可以动手先试下。</p>
<p><strong>小结</strong></p>
<p>在这节中，我们主要讲解了 Cookie 的基本使用，包含两部分内容</p>
<ul>
<li>发送 Cookie:
<ul>
<li>创建 Cookie 对象，并设置值：Cookie cookie = new Cookie (“key”,“value”);</li>
<li>发送 Cookie 到客户端使用的是 Reponse 对象:response.addCookie (cookie);</li>
</ul>
</li>
<li>获取 Cookie:
<ul>
<li>使用 Request 对象获取 Cookie 数组：Cookie [] cookies = request.getCookies ();</li>
<li>遍历数组</li>
<li>获取数组中每个 Cookie 对象的值:cookie.getName () 和 cookie.getValue ()</li>
</ul>
</li>
</ul>
<p>介绍完 Cookie 的基本使用之后，那么 Cookie 的底层到底是如何实现一次会话两次请求之间的数据共享呢？</p>
<h3 id="22-cookie的原理分析"><a class="markdownIt-Anchor" href="#22-cookie的原理分析">#</a> 2.2 Cookie 的原理分析</h3>
<p>对于 Cookie 的实现原理是基于 HTTP 协议的，其中设计到 HTTP 协议中的两个请求头信息:</p>
<ul>
<li>响应头:set-cookie</li>
<li>请求头: cookie</li>
</ul>
<p><img data-src="assets/1629393289338.png" alt="1629393289338"></p>
<ul>
<li>前面的案例中已经能够实现，AServlet 给前端发送 Cookie,BServlet 从 request 中获取 Cookie 的功能</li>
<li>对于 AServlet 响应数据的时候，Tomcat 服务器都是基于 HTTP 协议来响应数据</li>
<li>当 Tomcat 发现后端要返回的是一个 Cookie 对象之后，Tomcat 就会在响应头中添加一行数据 == <code>Set-Cookie:username=zs</code> ==</li>
<li>浏览器获取到响应结果后，从响应头中就可以获取到 <code>Set-Cookie</code>  对应值 <code>username=zs</code> , 并将数据存储在浏览器的内存中</li>
<li>浏览器再次发送请求给 BServlet 的时候，浏览器会自动在请求头中添加 == <code>Cookie: username=zs</code> == 发送给服务端 BServlet</li>
<li>Request 对象会把请求头中 cookie 对应的值封装成一个个 Cookie 对象，最终形成一个数组</li>
<li>BServlet 通过 Request 对象获取到 Cookie [] 后，就可以从中获取自己需要的数据</li>
</ul>
<p>接下来，使用刚才的案例，把上述结论验证下:</p>
<p>(1) 访问 AServlet 对应的地址 <code>http://localhost:8080/cookie-demo/aServlet</code></p>
<p>使用 Chrom 浏览器打开开发者工具 (F12 或 Crtl+Shift+I) 进行查看<mark>响应头</mark>中的数据</p>
<p><img data-src="assets/1629393428733.png" alt="1629393428733"></p>
<p>（2）访问 BServlet 对应的地址 `http://localhost:8080/cookie-demo/bServlet</p>
<p>使用 Chrom 浏览器打开开发者工具 (F12 或 Crtl+Shift+I) 进行查看<mark>请求头</mark>中的数据</p>
<p><img data-src="assets/1629393578667.png" alt="1629393578667"></p>
<h3 id="23-cookie的使用细节"><a class="markdownIt-Anchor" href="#23-cookie的使用细节">#</a> 2.3 Cookie 的使用细节</h3>
<p>在这节我们主要讲解两个知识，第一个是 Cookie 的存活时间，第二个是 Cookie 如何存储中文，首先来学习下 Cookie 的存活时间。</p>
<h4 id="231-cookie的存活时间"><a class="markdownIt-Anchor" href="#231-cookie的存活时间">#</a> 2.3.1 Cookie 的存活时间</h4>
<p>前面让大家思考过一个问题:</p>
<p><img data-src="assets/1629423321737.png" alt="1629423321737"></p>
<p>(1) 浏览器发送请求给 AServlet,AServlet 会响应一个存有 <code>usernanme=zs</code>  的 Cookie 对象给浏览器</p>
<p>(2) 浏览器接收到响应数据将 cookie 存入到浏览器内存中</p>
<p>(3) 当浏览器再次发送请求给 BServlet,BServlet 就可以使用 Request 对象获取到 Cookie 数据</p>
<p>(4) 在发送请求到 BServlet 之前，如果把浏览器关闭再打开进行访问，BServlet 能否获取到 Cookie 数据？</p>
<p><mark>注意：浏览器关闭再打开不是指打开一个新的选显卡，而且必须是先关闭再打开，顺序不能变。</mark></p>
<p>针对上面这个问题，通过演示，会发现，BServlet 中无法再获取到 Cookie 数据，这是为什么呢？</p>
<ul>
<li>默认情况下，Cookie 存储在浏览器内存中，当浏览器关闭，内存释放，则 Cookie 被销毁</li>
</ul>
<p>这个结论就印证了上面的演示效果，但是如果使用这种默认情况下的 Cookie, 有些需求就无法实现，比如:</p>
<p><img data-src="assets/1629423629887.png" alt="1629423629887"></p>
<p>上面这个网站的登录页面上有一个 <code>记住我</code> 的功能，这个功能大家都比较熟悉</p>
<ul>
<li>第一次输入用户名和密码并勾选 <code>记住我</code> 然后进行登录</li>
<li>下次再登陆的时候，用户名和密码就会被自动填充，不需要再重新输入登录</li>
<li>比如 <code>记住我</code> 这个功能需要记住用户名和密码一个星期，那么使用默认情况下的 Cookie 就会出现问题</li>
<li>因为默认情况，浏览器一关，Cookie 就会从浏览器内存中删除，对于 <code>记住我</code> 功能就无法实现</li>
</ul>
<p>所以我们现在就遇到一个难题是如何将 Cookie 持久化存储？</p>
<p>Cookie 其实已经为我们提供好了对应的 API 来完成这件事，这个 API 就是<mark> setMaxAge</mark>,</p>
<ul>
<li>设置 Cookie 存活时间</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setMaxAge(int seconds)</span><br></pre></td></tr></table></figure>
<p>参数值为:</p>
<p>1. 正数：将 Cookie 写入浏览器所在电脑的硬盘，持久化存储。到时间自动删除</p>
<p>2. 负数：默认值，Cookie 在当前浏览器内存中，当浏览器关闭，则 Cookie 被销毁</p>
<p>3. 零：删除对应 Cookie</p>
<p>接下来，咱们就在 AServlet 中去设置 Cookie 的存活时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="comment">//1. 创建Cookie对象</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        <span class="comment">//设置存活时间   ，1周 7天</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>); <span class="comment">//易阅读，需程序计算</span></span><br><span class="line">		<span class="comment">//cookie.setMaxAge(604800); //不易阅读(可以使用注解弥补)，程序少进行一次计算</span></span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改完代码后，启动测试，访问 <code>http://localhost:8080/cookie-demo/aServlet</code></p>
<ul>
<li>访问一个 AServlet 后，把浏览器关闭重启后，再去访问 <code>http://localhost:8080/cookie-demo/bServet</code> , 能在控制台打印出 <code>username:zs</code> , 说明 Cookie 没有随着浏览器关闭而被销毁</li>
<li>通过浏览器查看 Cookie 的内容，会发现 Cookie 的相关信息</li>
</ul>
<p><img data-src="assets/1629424844041.png" alt="1629424844041"></p>
<h4 id="232-cookie存储中文"><a class="markdownIt-Anchor" href="#232-cookie存储中文">#</a> 2.3.2 Cookie 存储中文</h4>
<p>首先，先来演示一个效果，将之前 <code>username=zs</code>  的值改成 <code>username=张三</code> ，把汉字 <code>张三</code> 存入到 Cookie 中，看是什么效果:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"> 		<span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,value);</span><br><span class="line">        <span class="comment">//设置存活时间   ，1周 7天</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动访问测试，访问 <code>http://localhost:8080/cookie-demo/aServlet</code>  会发现浏览器会提示错误信息</p>
<p><img data-src="assets/1629425945465.png" alt="1629425945465"></p>
<p>通过上面的案例演示，我们得到一个结论:</p>
<ul>
<li>Cookie 不能直接存储中文</li>
</ul>
<p>Cookie 不能存储中文，但是如果有这方面的需求，这个时候该如何解决呢？</p>
<p>这个时候，我们可以使用之前学过的一个知识点叫 <code>URL编码</code> ，所以如果需要存储中文，就需要进行转码，具体的实现思路为:</p>
<blockquote>
<p>1. 在 AServlet 中对中文进行 URL 编码，采用 URLEncoder.encode ()，将编码后的值存入 Cookie 中</p>
<p>2. 在 BServlet 中获取 Cookie 中的值，获取的值为 URL 编码后的值</p>
<p>3. 将获取的值在进行 URL 解码，采用 URLDecoder.decode ()，就可以获取到对应的中文值</p>
</blockquote>
<p>(1) 在 AServlet 中对中文进行 URL 编码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/aServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//发送Cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">        <span class="comment">//对中文进行URL编码</span></span><br><span class="line">        value = URLEncoder.encode(value, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;存储数据：&quot;</span>+value);</span><br><span class="line">        <span class="comment">//将编码后的值存入Cookie中</span></span><br><span class="line">        <span class="type">Cookie</span> <span class="variable">cookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,value);</span><br><span class="line">        <span class="comment">//设置存活时间   ，1周 7天</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);</span><br><span class="line">        <span class="comment">//2. 发送Cookie，response</span></span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2) 在 BServlet 中获取值，并对值进行解码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/bServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取Cookie</span></span><br><span class="line">        <span class="comment">//1. 获取Cookie数组</span></span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="comment">//2. 遍历数组</span></span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="comment">//3. 获取数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cookie.getName();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;username&quot;</span>.equals(name))&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cookie.getValue();<span class="comment">//获取的是URL编码后的值 %E5%BC%A0%E4%B8%89</span></span><br><span class="line">                <span class="comment">//URL解码</span></span><br><span class="line">                value = URLDecoder.decode(value,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">                System.out.println(name+<span class="string">&quot;:&quot;</span>+value);<span class="comment">//value解码后为 张三</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，我们就可以将中文存入 Cookie 中进行使用。</p>
<p><strong>小结</strong></p>
<p>Cookie 的使用细节中，我们讲了 Cookie 的 <code>存活时间</code> 和 <code>存储中文</code> :</p>
<ul>
<li>
<p>存活时间，需要掌握 setMaxAage () API 的使用</p>
</li>
<li>
<p>存储中文，需要掌握 URL 编码和解码的使用</p>
</li>
</ul>
<h2 id="3session"><a class="markdownIt-Anchor" href="#3session">#</a> 3，Session</h2>
<p>Cookie 已经能完成一次会话多次请求之间的数据共享，之前我们还提到过 Session 也可以实现，那么:</p>
<ul>
<li>什么是 Session?</li>
<li>Session 如何来使用？</li>
<li>Session 是如何实现的？</li>
<li>Session 的使用注意事项有哪些？</li>
</ul>
<h3 id="31-session的基本使用"><a class="markdownIt-Anchor" href="#31-session的基本使用">#</a> 3.1 Session 的基本使用</h3>
<p><strong>1. 概念</strong></p>
<p><mark>Session</mark>：服务端会话跟踪技术：将数据保存到服务端。</p>
<ul>
<li>Session 是存储在服务端而 Cookie 是存储在客户端</li>
<li>存储在客户端的数据容易被窃取和截获，存在很多不安全的因素</li>
<li>存储在服务端的数据相比于客户端来说就更安全</li>
</ul>
<p><strong>2.Session 的工作流程</strong></p>
<p><img data-src="assets/1629427173389.png" alt="1629427173389"></p>
<ul>
<li>在服务端的 AServlet 获取一个 Session 对象，把数据存入其中</li>
<li>在服务端的 BServlet 获取到相同的 Session 对象，从中取出数据</li>
<li>就可以实现一次会话中多次请求之间的数据共享了</li>
<li>现在最大的问题是如何保证 AServlet 和 BServlet 使用的是同一个 Session 对象 (在原理分析会讲解)?</li>
</ul>
<p><strong>3.Session 的基本使用</strong></p>
<p>在 JavaEE 中提供了 HttpSession 接口，来实现一次会话的多次请求之间数据共享功能。</p>
<p>具体的使用步骤为:</p>
<ul>
<li>获取 Session 对象，使用的是 request 对象</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>Session 对象提供的功能:</p>
<ul>
<li>
<p>存储数据到 session 域中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void setAttribute(String name, Object o)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>根据 key，获取值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object getAttribute(String name)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>根据 key，删除该键值对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void removeAttribute(String name)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>介绍完 Session 相关的 API 后，接下来通过一个案例来完成对 Session 的使用，具体实现步骤为:</p>
<blockquote>
<p>需求：在一个 Servlet 中往 Session 中存入数据，在另一个 Servlet 中获取 Session 中存入的数据</p>
<p>1. 创建名为 SessionDemo1 的 Servlet 类</p>
<p>2. 创建名为 SessionDemo2 的 Servlet 类</p>
<p>3. 在 SessionDemo1 的方法中：获取 Session 对象、存储数据</p>
<p>4. 在 SessionDemo2 的方法中：获取 Session 对象、获取数据</p>
<p>5. 启动测试</p>
</blockquote>
<p>(1) 创建名为 SessionDemo1 的 Servlet 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2) 创建名为 SessionDemo2 的 Servlet 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) SessionDemo1: 获取 Session 对象、存储数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    	<span class="comment">//存储到Session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2. 存储数据</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(4) SessionDemo2: 获取 Session 对象、获取数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取数据，从session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2. 获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(5) 启动测试，</p>
<ul>
<li>先访问 <code>http://localhost:8080/cookie-demo/demo1</code> , 将数据存入 Session</li>
<li>在访问 <code>http://localhost:8080/cookie-demo/demo2</code> , 从 Session 中获取数据</li>
<li>查看控制台</li>
</ul>
<p><img data-src="assets/1629428292373.png" alt="1629428292373"></p>
<p>通过案例的效果，能看到 Session 是能够在一次会话中两次请求之间共享数据。</p>
<p><strong>小结</strong></p>
<p>至此 Session 的基本使用就已经完成了，重点要掌握的是:</p>
<ul>
<li>
<p>Session 的获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Session 常用方法的使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">void setAttribute(String name, Object o)</span><br><span class="line">Object getAttribute(String name)</span><br></pre></td></tr></table></figure>
<p>** 注意:**Session 中可以存储的是一个 Object 类型的数据，也就是说 Session 中可以存储任意数据类型。</p>
</li>
</ul>
<p>介绍完 Session 的基本使用之后，那么 Session 的底层到底是如何实现一次会话两次请求之间的数据共享呢？</p>
<h3 id="32-session的原理分析"><a class="markdownIt-Anchor" href="#32-session的原理分析">#</a> 3.2 Session 的原理分析</h3>
<ul>
<li>Session 是基于 Cookie 实现的</li>
</ul>
<p>这句话其实不太能详细的说明 Session 的底层实现，接下来，咱们一步步来分析下 Session 的具体实现原理:</p>
<p>(1) 前提条件</p>
<p><img data-src="assets/1629429063101.png" alt="1629429063101"></p>
<p>Session 要想实现一次会话多次请求之间的数据共享，就必须要保证多次请求获取 Session 的对象是同一个。</p>
<p>那么它们是一个对象么？要验证这个结论也很简单，只需要在上面案例中的两个 Servlet 中分别打印下 Session 对象</p>
<p>SessionDemo1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    	<span class="comment">//存储到Session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        System.out.println(session);</span><br><span class="line">        <span class="comment">//2. 存储数据</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SessionDemo2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取数据，从session中</span></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        System.out.println(session);</span><br><span class="line">        <span class="comment">//2. 获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动测试，分别访问</p>
<p><code>http://localhost:8080/cookie-demo/demo1</code></p>
<p><code>http://localhost:8080/cookie-demo/demo2</code></p>
<p><img data-src="assets/1629429239409.png" alt="1629429239409"></p>
<p>通过打印可以得到如下结论:</p>
<ul>
<li>两个 Servlet 类中获取的 Session 对象是同一个</li>
<li>把 demo1 和 demo2 请求刷新多次，控制台最终打印的结果都是同一个</li>
</ul>
<p>那么问题又来了，如果新开一个浏览器，访问 demo1 或者 demo2, 打印在控制台的 Session 还是同一个对象么？</p>
<p><img data-src="assets/1629429788264.png" alt="1629429788264"></p>
<p><mark>注意：在一台电脑上演示的时候，如果是相同的浏览器必须要把浏览器全部关掉重新打开，才算新开的一个浏览器。</mark></p>
<p>当然也可以使用不同的浏览器进行测试，就不需要把之前的浏览器全部关闭。</p>
<p>测试的结果：如果是不同浏览器或者重新打开浏览器后，打印的 Session 就不一样了。</p>
<p>所以 Session 实现的也是一次会话中的多次请求之间的数据共享。</p>
<p>那么最主要的问题就来了，Session 是如何保证在一次会话中获取的 Session 对象是同一个呢？</p>
<p><img data-src="assets/1629430754825.png" alt="1629430754825"></p>
<p>(1) demo1 在第一次获取 session 对象的时候，session 对象会有一个唯一的标识，假如是 <code>id:10</code></p>
<p>(2) demo1 在 session 中存入其他数据并处理完成所有业务后，需要通过 Tomcat 服务器响应结果给浏览器</p>
<p>(3) Tomcat 服务器发现业务处理中使用了 session 对象，就会把 session 的唯一标识 <code>id:10</code>  当做一个 cookie，添加 <code>Set-Cookie:JESSIONID=10</code>  到响应头中，并响应给浏览器</p>
<p>(4) 浏览器接收到响应结果后，会把响应头中的 coookie 数据存储到浏览器的内存中</p>
<p>(5) 浏览器在同一会话中访问 demo2 的时候，会把 cookie 中的数据按照 <code>cookie: JESSIONID=10</code>  的格式添加到请求头中并发送给服务器 Tomcat</p>
<p>(6) demo2 获取到请求后，从请求头中就读取 cookie 中的 JSESSIONID 值为 10，然后就会到服务器内存中寻找 <code>id:10</code>  的 session 对象，如果找到了，就直接返回该对象，如果没有则新创建一个 session 对象</p>
<p>(7) 关闭打开浏览器后，因为浏览器的 cookie 已被销毁，所以就没有 JESSIONID 的数据，服务端获取到的 session 就是一个全新的 session 对象</p>
<p>至此， <code>Session是基于Cookie来实现的</code> 这就话，我们就解释完了，接下来通过实例来演示下:</p>
<p>(1) 使用 chrome 浏览器访问 <code>http://localhost:8080/cookie-demo/demo1</code> , 打开开发者模式 (F12 或 Ctrl+Shift+I), 查看 == 响应头 (Response Headers)== 数据:</p>
<p><img data-src="assets/1629430891071.png" alt="1629430891071"></p>
<p>(2) 使用 chrome 浏览器再次访问 <code>http://localhost:8080/cookie-demo/demo2</code> ，查看 == 请求头 (Request Headers)== 数据:</p>
<p><img data-src="assets/1629431299195.png" alt="1629431299195"></p>
<p><strong>小结</strong></p>
<p>介绍完 Session 的原理，我们只需要记住</p>
<ul>
<li>Session 是基于 Cookie 来实现的</li>
</ul>
<h3 id="33-session的使用细节"><a class="markdownIt-Anchor" href="#33-session的使用细节">#</a> 3.3 Session 的使用细节</h3>
<p>这节我们会主要讲解两个知识，第一个是 Session 的钝化和活化，第二个是 Session 的销毁，首先来学习什么是 Session 的钝化和活化？</p>
<h4 id="331-session钝化与活化"><a class="markdownIt-Anchor" href="#331-session钝化与活化">#</a> 3.3.1 Session 钝化与活化</h4>
<p>首先需要大家思考的问题是:</p>
<ul>
<li>服务器重启后，Session 中的数据是否还在？</li>
</ul>
<p>要想回答这个问题，我们可以先看下下面这幅图，</p>
<p><img data-src="assets/1629438984314.png" alt="1629438984314"></p>
<p>(1) 服务器端 AServlet 和 BServlet 共用的 session 对象应该是存储在服务器的内存中</p>
<p>(2) 服务器重新启动后，内存中的数据应该是已经被释放，对象也应该都销毁了</p>
<p>所以 session 数据应该也已经不存在了。但是如果 session 不存在会引发什么问题呢？</p>
<p>举个例子说明下，</p>
<p>(1) 用户把需要购买的商品添加到购物车，因为要实现同一个会话多次请求数据共享，所以假设把数据存入 Session 对象中</p>
<p>(2) 用户正要付钱的时候接到一个电话，付钱的动作就搁浅了</p>
<p>(3) 正在用户打电话的时候，购物网站因为某些原因需要重启</p>
<p>(4) 重启后 session 数据被销毁，购物车中的商品信息也就会随之而消失</p>
<p>(5) 用户想再次发起支付，就会出为问题</p>
<p>所以说对于 session 的数据，我们应该做到就算服务器重启了，也应该能把数据保存下来才对。</p>
<p>分析了这么多，那么 Tomcat 服务器在重启的时候，session 数据到底会不会保存以及是如何保存的，我们可以通过实际案例来演示下:</p>
<p><mark>注意：这里所说的关闭和启动应该要确保是正常的关闭和启动。</mark></p>
<p>那如何才是正常关闭 Tomcat 服务器呢？</p>
<p>需要使用命令行的方式来启动和停止 Tomcat 服务器:</p>
<p><mark>启动</mark>：进入到项目 pom.xml 所在目录，执行 <code>tomcat7:run</code></p>
<p><img data-src="assets/1629439800328.png" alt="1629439800328"></p>
<p><mark>停止</mark>：在启动的命令行界面，输入 <code>ctrl+c</code></p>
<p><img data-src="assets/1629439879596.png" alt="1629439879596"></p>
<p>有了上述两个正常启动和关闭的方式后，接下来的测试流程是:</p>
<p>(1) 先启动 Tomcat 服务器</p>
<p>(2) 访问 <code>http://localhost:8080/cookie-demo/demo1</code>  将数据存入 session 中</p>
<p>(3) 正确停止 Tomcat 服务器</p>
<p>(4) 再次重新启动 Tomcat 服务器</p>
<p>(5) 访问 <code>http://localhost:8080/cookie-demo/demo2</code>  查看是否能获取到 session 中的数据</p>
<p><img data-src="assets/1629440018238.png" alt="1629440018238"></p>
<p>经过测试，会发现只要服务器是正常关闭和启动，session 中的数据是可以被保存下来的。</p>
<p>那么 Tomcat 服务器到底是如何做到的呢？</p>
<p>具体的原因就是：Session 的钝化和活化:</p>
<ul>
<li>
<p>钝化：在服务器正常关闭后，Tomcat 会自动将 Session 数据写入硬盘的文件中</p>
<ul>
<li>
<p>钝化的数据路径为: <code>项目目录\target\tomcat\work\Tomcat\localhost\项目名称\SESSIONS.ser</code></p>
<p><img data-src="assets/1629440576828.png" alt="1629440576828"></p>
</li>
</ul>
</li>
<li>
<p>活化：再次启动服务器后，从文件中加载数据到 Session 中</p>
<ul>
<li>数据加载到 Session 中后，路径中的 <code>SESSIONS.ser</code>  文件会被删除掉</li>
</ul>
</li>
</ul>
<p>对于上述的整个过程，大家只需要了解下即可。因为所有的过程都是 Tomcat 自己完成的，不需要我们参与。</p>
<p><strong>小结</strong></p>
<p>Session 的钝化和活化介绍完后，需要我们注意的是:</p>
<ul>
<li>
<p>session 数据存储在服务端，服务器重启后，session 数据会被保存</p>
</li>
<li>
<p>浏览器被关闭启动后，重新建立的连接就已经是一个全新的会话，获取的 session 数据也是一个新的对象</p>
</li>
<li>
<p>session 的数据要想共享，浏览器不能关闭，所以 session 数据不能长期保存数据</p>
</li>
<li>
<p>cookie 是存储在客户端，是可以长期保存</p>
</li>
</ul>
<h4 id="332-session销毁"><a class="markdownIt-Anchor" href="#332-session销毁">#</a> 3.3.2 Session 销毁</h4>
<p>session 的销毁会有两种方式:</p>
<ul>
<li>
<p>默认情况下，无操作，30 分钟自动销毁</p>
<ul>
<li>
<p>对于这个失效时间，是可以通过配置进行修改的</p>
<ul>
<li>
<p>在项目的 web.xml 中配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>100<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>如果没有配置，默认是 30 分钟，默认值是在 Tomcat 的 web.xml 配置文件中写死的</p>
<p><img data-src="assets/1629441687613.png" alt="1629441687613"></p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>调用 Session 对象的 invalidate () 进行销毁</p>
<ul>
<li>
<p>在 SessionDemo2 类中添加 session 销毁的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取数据，从session中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 获取Session对象</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        System.out.println(session);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 销毁</span></span><br><span class="line">        session.invalidate();</span><br><span class="line">        <span class="comment">//2. 获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">username</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动访问测试，先访问 demo1 将数据存入到 session，再次访问 demo2 从 session 中获取数据</p>
<p><img data-src="assets/1629441900843.png" alt="1629441900843"></p>
</li>
<li>
<p>该销毁方法一般会在用户退出的时候，需要将 session 销毁掉。</p>
</li>
</ul>
</li>
</ul>
<p><strong>Cookie 和 Session 小结</strong></p>
<ul>
<li>Cookie 和 Session 都是来完成一次会话内多次请求间<mark>数据共享</mark>的。</li>
</ul>
<p>所需两个对象放在一块，就需要思考:</p>
<p>Cookie 和 Session 的区别是什么？</p>
<p>Cookie 和 Session 的应用场景分别是什么？</p>
<ul>
<li>区别:
<ul>
<li>存储位置：Cookie 是将数据存储在客户端，Session 将数据存储在服务端</li>
<li>安全性：Cookie 不安全，Session 安全</li>
<li>数据大小：Cookie 最大 3KB，Session 无大小限制</li>
<li>存储时间：Cookie 可以通过 setMaxAge () 长期存储，Session 默认 30 分钟</li>
<li>服务器性能：Cookie 不占服务器资源，Session 占用服务器资源</li>
</ul>
</li>
<li>应用场景:
<ul>
<li>购物车：使用 Cookie 来存储</li>
<li>以登录用户的名称展示：使用 Session 来存储</li>
<li>记住我功能：使用 Cookie 来存储</li>
<li>验证码：使用 session 来存储</li>
</ul>
</li>
<li>结论
<ul>
<li>Cookie 是用来保证用户在未登录情况下的身份识别</li>
<li>Session 是用来保存用户登录后的数据</li>
</ul>
</li>
</ul>
<p>介绍完 Cookie 和 Session 以后，具体用哪个还是需要根据具体的业务进行具体分析。</p>
<h2 id="4用户登录注册案例"><a class="markdownIt-Anchor" href="#4用户登录注册案例">#</a> 4，用户登录注册案例</h2>
<h3 id="41-需求分析"><a class="markdownIt-Anchor" href="#41-需求分析">#</a> 4.1 需求分析</h3>
<p>需求说明：</p>
<ol>
<li>
<p>完成用户登录功能，如果用户勾选 “记住用户” ，则下次访问登录页面<mark>自动</mark>填充用户名密码</p>
</li>
<li>
<p>完成注册功能，并实现<mark>验证码</mark>功能</p>
</li>
</ol>
<p><img data-src="assets/1629442826981.png" alt="1629442826981"></p>
<h3 id="42-用户登录功能"><a class="markdownIt-Anchor" href="#42-用户登录功能">#</a> 4.2 用户登录功能</h3>
<ol>
<li>需求:</li>
</ol>
<p><img data-src="assets/1629443152010.png" alt="1629443152010"></p>
<ul>
<li>用户登录成功后，跳转到列表页面，并在页面上展示当前登录的用户名称</li>
<li>用户登录失败后，跳转回登录页面，并在页面上展示对应的错误信息</li>
</ul>
<ol start="2">
<li>实现流程分析</li>
</ol>
<p><img data-src="assets/1629443379531.png" alt="1629443379531"></p>
<p>(1) 前端通过表单发送请求和数据给 Web 层的 LoginServlet</p>
<p>(2) 在 LoginServlet 中接收请求和数据 [用户名和密码]</p>
<p>(3) LoginServlet 接收到请求和数据后，调用 Service 层完成根据用户名和密码查询用户对象</p>
<p>(4) 在 Service 层需要编写 UserService 类，在类中实现 login 方法，方法中调用 Dao 层的 UserMapper</p>
<p>(5) 在 UserMapper 接口中，声明一个根据用户名和密码查询用户信息的方法</p>
<p>(6) Dao 层把数据查询出来以后，将返回数据封装到 User 对象，将对象交给 Service 层</p>
<p>(7) Service 层将数据返回给 Web 层</p>
<p>(8) Web 层获取到 User 对象后，判断 User 对象，如果为 Null, 则将错误信息响应给登录页面，如果不为 Null，则跳转到列表页面，并把当前登录用户的信息存入 Session 携带到列表页面。</p>
<ol start="3">
<li>具体实现</li>
</ol>
<p>(1) 完成 Dao 层的代码编写</p>
<p>(1.1) 将 <code>04-资料\1. 登录注册案例\2. MyBatis环境\UserMapper.java</code>  放到 com.itheima.mapper` 包下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名和密码查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">select</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username,<span class="meta">@Param(&quot;password&quot;)</span>  String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into tb_user values(null,#&#123;username&#125;,#&#123;password&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(1.2) 将 <code>04-资料\1. 登录注册案例\2. MyBatis环境\User.java</code>  放到 <code>com.itheima.pojo</code>  包下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(1.3) 将 <code>04-资料\1. 登录注册案例\2. MyBatis环境\UserMapper.xml</code>  放入到 resources/com/itheima/mapper` 目录下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>(2) 完成 Service 层的代码编写</p>
<p>(2.1) 在 <code>com.itheima.service</code>  包下，创建 UserService 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//1.使用工具类获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String username,String password)</span>&#123;</span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取UserMapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.select(username, password);</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>  user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) 完成页面和 Web 层的代码编写</p>
<p>(3.1) 将 <code>04-资料\1. 登录注册案例\1. 静态页面</code> 拷贝到项目的 <code>webapp</code>  目录下:</p>
<p><img data-src="assets/1629444649629.png" alt="1629444649629"></p>
<p>(3.2) 将 login.html 内容修改成 login.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;login&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;loginDiv&quot;</span> style=<span class="string">&quot;height: 350px&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/brand-demo/loginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;loginMsg&quot;</span>&gt;LOGIN IN&lt;/h1&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;用户名或密码不正确&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;Username:&lt;input id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> type=<span class="string">&quot;text&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Password:&lt;input id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Remember:&lt;input id=<span class="string">&quot;remember&quot;</span> name=<span class="string">&quot;remember&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;subDiv&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;login up&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;reset&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;reset&quot;</span>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">            &lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>(3.3) 创建 LoginServlet 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 获取用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">   </span><br><span class="line">        <span class="comment">//2. 调用service查询</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> service.login(username, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 判断</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//登录成功，跳转到查询所有的BrandServlet</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//将登陆成功后的user对象，存储到session</span></span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">            </span><br><span class="line">            <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/selectAllServlet&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登录失败,</span></span><br><span class="line">            <span class="comment">// 存储错误信息到request</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;login_msg&quot;</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">            <span class="comment">// 跳转到login.jsp</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3.4) 在 brand.jsp 中<body>标签下添加欢迎当前用户的提示信息:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;$&#123;user.username&#125;,欢迎您&lt;/h1&gt;</span><br></pre></td></tr></table></figure>
<p>(3.5) 修改 login.jsp，将错误信息使用 EL 表达式来获取</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改前内容:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;用户名或密码不正确&lt;/div&gt;</span><br><span class="line">修改后内容: &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>(4) 启动，访问测试</p>
<p>(4.1) 进入登录页面，输入错误的用户名或密码</p>
<p><img data-src="assets/1629445376407.png" alt="1629445376407"></p>
<p>(4.2) 输入正确的用户和密码信息</p>
<p><img data-src="assets/1629445415216.png" alt="1629445415216"></p>
<p><strong>小结</strong></p>
<ul>
<li>在 LoginServlet 中，将登录成功的用户数据存入 session 中，方法在列表页面中获取当前登录用户信息进行展示</li>
<li>在 LoginServlet 中，将登录失败的错误信息存入到 request 中，如果存入到 session 中就会出现这次会话的所有请求都有登录失败的错误信息，这个是不需要的，所以不用存入到 session 中</li>
</ul>
<h3 id="43-记住我-设置cookie"><a class="markdownIt-Anchor" href="#43-记住我-设置cookie">#</a> 4.3 记住我 - 设置 Cookie</h3>
<ol>
<li>需求:</li>
</ol>
<p>如果用户勾选 “记住用户” ，则下次访问登陆页面自动填充用户名密码。这样可以提升用户的体验。</p>
<p><img data-src="assets/1629445835281.png" alt="1629445835281"></p>
<p>对应上面这个需求，最大的问题就是：如何自动填充用户名和密码？</p>
<ol start="2">
<li>实现流程分析</li>
</ol>
<p>因为 <code>记住我</code> 功能要实现的效果是，就算用户把浏览器关闭过几天再来访问也能自动填充，所以需要将登陆信息存入一个可以长久保存，并且能够在浏览器关闭重新启动后依然有效的地方，就是我们前面讲的<mark> Cookie</mark>, 所以:</p>
<ul>
<li>
<p>将用户名和密码写入<mark> Cookie</mark> 中，并且持久化存储 Cookie, 下次访问浏览器会自动携带 Cookie</p>
</li>
<li>
<p>在页面获取 Cookie 数据后，设置到用户名和密码框中</p>
</li>
<li>
<p>何时写入 Cookie?</p>
<ul>
<li>用户必须登陆成功后才需要写</li>
<li>用户必须在登录页面勾选了 <code>记住我</code> 的复选框</li>
</ul>
</li>
</ul>
<p><img data-src="assets/1629446248511.png" alt="1629446248511"></p>
<p>(1) 前端需要在发送请求和数据的时候，多携带一个用户是否勾选 <code>Remember</code>  的数据</p>
<p>(2) LoginServlet 获取到数据后，调用 Service 完成用户名和密码的判定</p>
<p>(3) 登录成功，并且用户在前端勾选了 <code>记住我</code> ，需要往 Cookie 中写入用户名和密码的数据，并设置 Cookie 存活时间</p>
<p>(4) 设置成功后，将数据响应给前端</p>
<ol start="3">
<li>具体实现</li>
</ol>
<p>(1) 在 login.jsp 为复选框设置值</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;login&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;loginDiv&quot;</span> style=<span class="string">&quot;height: 350px&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/brand-demo/loginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;loginMsg&quot;</span>&gt;LOGIN IN&lt;/h1&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;Username:&lt;input id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> type=<span class="string">&quot;text&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Password:&lt;input id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Remember:&lt;input id=<span class="string">&quot;remember&quot;</span> name=<span class="string">&quot;remember&quot;</span> value=<span class="string">&quot;1&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;subDiv&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;login up&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;reset&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;reset&quot;</span>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">            &lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>(2) 在 LoginServlet 获取复选框的值并在登录成功后进行设置 Cookie</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 获取用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取复选框数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">remember</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;remember&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service查询</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> service.login(username, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 判断</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//登录成功，跳转到查询所有的BrandServlet</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//判断用户是否勾选记住我，字符串写前面是为了避免出现空指针异常</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(remember))&#123;</span><br><span class="line">                <span class="comment">//勾选了，发送Cookie</span></span><br><span class="line">                <span class="comment">//1. 创建Cookie对象</span></span><br><span class="line">                <span class="type">Cookie</span> <span class="variable">c_username</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">                <span class="type">Cookie</span> <span class="variable">c_password</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;password&quot;</span>,password);</span><br><span class="line">                <span class="comment">// 设置Cookie的存活时间</span></span><br><span class="line">                c_username.setMaxAge( <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>);</span><br><span class="line">                c_password.setMaxAge( <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>);</span><br><span class="line">                <span class="comment">//2. 发送</span></span><br><span class="line">                response.addCookie(c_username);</span><br><span class="line">                response.addCookie(c_password);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将登陆成功后的user对象，存储到session</span></span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/selectAllServlet&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登录失败,</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 存储错误信息到request</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;login_msg&quot;</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 跳转到login.jsp</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) 启动访问测试，</p>
<p>只有当前用户名和密码输入正确，并且勾选了 Remeber 的复选框，在响应头中才可以看得 cookie 的相关数据</p>
<p><img data-src="assets/1629447232217.png" alt="1629447232217"></p>
<h3 id="44-记住我-获取cookie"><a class="markdownIt-Anchor" href="#44-记住我-获取cookie">#</a> 4.4 记住我 - 获取 Cookie</h3>
<ol>
<li>需求</li>
</ol>
<p>登录成功并勾选了 Remeber 后，后端返回给前端的 Cookie 数据就已经存储好了，接下来就需要在页面获取 Cookie 中的数据，并把数据设置到登录页面的用户名和密码框中。</p>
<p><img data-src="assets/1629449100282.png" alt="1629449100282"></p>
<p>如何在页面直接获取 Cookie 中的值呢？</p>
<ol start="2">
<li>实现流程分析</li>
</ol>
<p>在页面可以使用 EL 表达式，${cookie.<mark>key</mark>.value}</p>
<p>key: 指的是存储在 cookie 中的键名称</p>
<p><img data-src="assets/1629449234735.png" alt="1629449234735"></p>
<p>(1) 在 login.jsp 用户名的表单输入框使用 value 值给表单元素添加默认值，value 可以使用 <code>$&#123;cookie.username.value&#125;</code></p>
<p>(2) 在 login.jsp 密码的表单输入框使用 value 值给表单元素添加默认值，value 可以使用 <code>$&#123;cookie.password.value&#125;</code></p>
<ol start="3">
<li>具体实现</li>
</ol>
<p>(1) 修改 login.jsp 页面</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;login&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/login.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;loginDiv&quot;</span> style=<span class="string">&quot;height: 350px&quot;</span>&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/brand-demo/loginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span> id=<span class="string">&quot;form&quot;</span>&gt;</span><br><span class="line">        &lt;h1 id=<span class="string">&quot;loginMsg&quot;</span>&gt;LOGIN IN&lt;/h1&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">        &lt;p&gt;Username:&lt;input id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;cookie.username.value&#125;&quot;</span> type=<span class="string">&quot;text&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;p&gt;Password:&lt;input id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;$&#123;cookie.password.value&#125;&quot;</span> type=<span class="string">&quot;password&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;Remember:&lt;input id=<span class="string">&quot;remember&quot;</span> name=<span class="string">&quot;remember&quot;</span> value=<span class="string">&quot;1&quot;</span> type=<span class="string">&quot;checkbox&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">        &lt;div id=<span class="string">&quot;subDiv&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;login up&quot;</span>&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;reset&quot;</span> class=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;reset&quot;</span>&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">            &lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>访问测试，重新访问登录页面，就可以看得用户和密码已经被填充。</li>
</ol>
<p><img data-src="assets/1629449530886.png" alt="1629449530886"></p>
<h3 id="45-用户注册功能"><a class="markdownIt-Anchor" href="#45-用户注册功能">#</a> 4.5 用户注册功能</h3>
<ol>
<li>需求</li>
</ol>
<ul>
<li>注册功能：保存用户信息到数据库</li>
<li>验证码功能
<ul>
<li>展示验证码：展示验证码图片，并可以点击切换</li>
<li>校验验证码：验证码填写不正确，则注册失败</li>
</ul>
</li>
</ul>
<p><img data-src="assets/1629449648793.png" alt="1629449648793"></p>
<ol start="2">
<li>实现流程分析</li>
</ol>
<p><img data-src="assets/1629449720005.png" alt="1629449720005"></p>
<p>(1) 前端通过表单发送请求和数据给 Web 层的 RegisterServlet</p>
<p>(2) 在 RegisterServlet 中接收请求和数据 [用户名和密码]</p>
<p>(3) RegisterServlet 接收到请求和数据后，调用 Service 层完成用户信息的保存</p>
<p>(4) 在 Service 层需要编写 UserService 类，在类中实现 register 方法，需要判断用户是否已经存在，如果不存在，则完成用户数据的保存</p>
<p>(5) 在 UserMapper 接口中，声明两个方法，一个是根据用户名查询用户信息方法，另一个是保存用户信息方法</p>
<p>(6) 在 UserService 类中保存成功则返回 true，失败则返回 false, 将数据返回给 Web 层</p>
<p>(7) Web 层获取到结果后，如果返回的是 true, 则提示 <code>注册成功</code> ，并转发到登录页面，如果返回 false 则提示 <code>用户名已存在</code> 并转发到注册页面</p>
<ol start="3">
<li>具体实现</li>
</ol>
<p>(1) Dao 层代码参考资料中的内容完成</p>
<p>(2) 编写 Service 层代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//1.使用工具类获取SqlSessionFactory</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">register</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="comment">//2. 获取SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取UserMapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//4. 判断用户名是否存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> mapper.selectByUsername(user.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(u == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 用户名不存在，注册</span></span><br><span class="line">            mapper.add(user);</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125;</span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> u == <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3) 完成页面和 Web 层的代码编写</p>
<p>(3.1) 将 register.html 内容修改成 register.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;欢迎注册&lt;/title&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/register.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=<span class="string">&quot;form-div&quot;</span>&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;reg-content&quot;</span>&gt;</span><br><span class="line">        &lt;h1&gt;欢迎注册&lt;/h1&gt;</span><br><span class="line">        &lt;span&gt;已有帐号？&lt;/span&gt; &lt;a href=<span class="string">&quot;login.html&quot;</span>&gt;登录&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;form id=<span class="string">&quot;reg-form&quot;</span> action=<span class="string">&quot;/brand-demo/registerServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;table&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;用户名&lt;/td&gt;</span><br><span class="line">                &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">                    &lt;input name=<span class="string">&quot;username&quot;</span> type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;username&quot;</span>&gt;</span><br><span class="line">                    &lt;br&gt;</span><br><span class="line">                    &lt;span id=<span class="string">&quot;username_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span> style=<span class="string">&quot;display:none&quot;</span>&gt;用户名不太受欢迎&lt;/span&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;密码&lt;/td&gt;</span><br><span class="line">                &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">                    &lt;input name=<span class="string">&quot;password&quot;</span> type=<span class="string">&quot;password&quot;</span> id=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">                    &lt;br&gt;</span><br><span class="line">                    &lt;span id=<span class="string">&quot;password_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span> style=<span class="string">&quot;display: none&quot;</span>&gt;密码格式有误&lt;/span&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;验证码&lt;/td&gt;</span><br><span class="line">                &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">                    &lt;input name=<span class="string">&quot;checkCode&quot;</span> type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;checkCode&quot;</span>&gt;</span><br><span class="line">                    &lt;img src=<span class="string">&quot;imgs/a.jpg&quot;</span>&gt;</span><br><span class="line">                    &lt;a href=<span class="string">&quot;#&quot;</span> id=<span class="string">&quot;changeImg&quot;</span> &gt;看不清？&lt;/a&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &lt;/table&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;buttons&quot;</span>&gt;</span><br><span class="line">            &lt;input value=<span class="string">&quot;注 册&quot;</span> type=<span class="string">&quot;submit&quot;</span> id=<span class="string">&quot;reg_btn&quot;</span>&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;br class=<span class="string">&quot;clear&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>(3.2) 编写 RegisterServlet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/registerServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       <span class="comment">//1. 获取用户名和密码数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service 注册</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> service.register(user);</span><br><span class="line">        <span class="comment">//3. 判断注册成功与否</span></span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">             <span class="comment">//注册功能，跳转登陆页面</span></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;注册成功，请登录&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//注册失败，跳转到注册页面</span></span><br><span class="line"></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3.3) 需要在页面上展示后台返回的错误信息，需要修改 register.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改前:&lt;span id=<span class="string">&quot;username_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span> style=<span class="string">&quot;display:none&quot;</span>&gt;用户名不太受欢迎&lt;/span&gt;</span><br><span class="line">修改后:&lt;span id=<span class="string">&quot;username_err&quot;</span> class=<span class="string">&quot;err_msg&quot;</span>&gt;$&#123;register_msg&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p>(3.4) 如果注册成功，需要把成功信息展示在登录页面，所以也需要修改 login.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改前:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125;&lt;/div&gt;</span><br><span class="line">修改后:&lt;div id=<span class="string">&quot;errorMsg&quot;</span>&gt;$&#123;login_msg&#125; $&#123;register_msg&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>(3.5) 修改 login.jsp，将注册跳转地址修改为 register.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改前：&lt;a href=<span class="string">&quot;register.html&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br><span class="line">修改后: &lt;a href=<span class="string">&quot;register.jsp&quot;</span>&gt;没有账号？&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<p>(3.6) 启动测试，</p>
<p>如果是注册的用户信息已经存在:</p>
<p><img data-src="assets/1629451535605.png" alt="1629451535605"></p>
<p>如果注册的用户信息不存在，注册成功:</p>
<p><img data-src="assets/1629451567428.png" alt="1629451567428"></p>
<h3 id="46-验证码-展示"><a class="markdownIt-Anchor" href="#46-验证码-展示">#</a> 4.6 验证码 - 展示</h3>
<ol>
<li>需求分析</li>
</ol>
<p>展示验证码：展示验证码图片，并可以点击切换</p>
<p><img data-src="assets/1629451646831.png" alt="1629451646831"></p>
<p>验证码的生成是通过工具类来实现的，具体的工具类参考</p>
<p><code>04-资料\1. 登录注册案例\CheckCodeUtil.java</code></p>
<p>在该工具类中编写 main 方法进行测试:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//生成验证码的图片位置</span></span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;d://a.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//checkCode为最终验证码的数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> CheckCodeUtil.outputVerifyImage(<span class="number">100</span>, <span class="number">50</span>, fos, <span class="number">4</span>);</span><br><span class="line">    System.out.println(checkCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>生成完验证码以后，我们就可以知晓:</p>
<ul>
<li>验证码就是使用 Java 代码生成的一张图片</li>
<li>验证码的作用：防止机器自动注册，攻击服务器</li>
</ul>
<ol start="2">
<li>实现流程分析</li>
</ol>
<p><img data-src="assets/1629452623289.png" alt="1629452623289"></p>
<p>(1) 前端发送请求给 CheckCodeServlet</p>
<p>(2) CheckCodeServlet 接收到请求后，生成验证码图片，将图片用 Reponse 对象的输出流写回到前端</p>
<p>思考：如何将图片写回到前端浏览器呢？</p>
<p>(1) Java 中已经有工具类生成验证码图片，测试类中只是把图片生成到磁盘上<br>
 (2) 生成磁盘的过程中使用的是 OutputStream 流，如何把这个图片生成在页面呢？<br>
(3) 前面在将 Reponse 对象的时候，它有一个方法可以获取其字节输出流，getOutputStream ()<br>
(4) 综上所述，我们可以把写往磁盘的流对象更好成 Response 的字节流，即可完成图片响应给前端</p>
<ol start="3">
<li>具体实现</li>
</ol>
<p>(1) 修改 Register.jsp 页面，将验证码的图片从后台获取</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;tr&gt;</span><br><span class="line">    &lt;td&gt;验证码&lt;/td&gt;</span><br><span class="line">        &lt;td class=<span class="string">&quot;inputs&quot;</span>&gt;</span><br><span class="line">        &lt;input name=<span class="string">&quot;checkCode&quot;</span> type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;checkCode&quot;</span>&gt;</span><br><span class="line">        &lt;img id=<span class="string">&quot;checkCodeImg&quot;</span> src=<span class="string">&quot;/brand-demo/checkCodeServlet&quot;</span>&gt;</span><br><span class="line">        &lt;a href=<span class="string">&quot;#&quot;</span> id=<span class="string">&quot;changeImg&quot;</span> &gt;看不清？&lt;/a&gt;</span><br><span class="line">    &lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    document.getElementById(<span class="string">&quot;changeImg&quot;</span>).onclick = function () &#123;</span><br><span class="line">       	<span class="comment">//路径后面添加时间戳的目的是避免浏览器进行缓存静态资源</span></span><br><span class="line">        document.getElementById(<span class="string">&quot;checkCodeImg&quot;</span>).src = <span class="string">&quot;/brand-demo/checkCodeServlet?&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>().getMilliseconds();</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>(2) 编写 CheckCodeServlet 类，用来接收请求生成验证码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/checkCodeServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> CheckCodeUtil.outputVerifyImage(<span class="number">100</span>, <span class="number">50</span>, os, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="47验证码-校验"><a class="markdownIt-Anchor" href="#47验证码-校验">#</a> 4.7 验证码 - 校验</h3>
<ol>
<li>需求</li>
</ol>
<ul>
<li>判断程序生成的验证码 和 用户输入的验证码 是否一样，如果不一样，则阻止注册</li>
<li>验证码图片访问和提交注册表单是<mark>两次</mark>请求，所以要将程序生成的验证码存入 Session 中</li>
</ul>
<p><img data-src="assets/1629452835571.png" alt="1629452835571"></p>
<p>思考：为什么要把验证码数据存入到 Session 中呢？</p>
<ul>
<li>生成验证码和校验验证码是两次请求，此处就需要在一个会话的两次请求之间共享数据</li>
<li>验证码属于安全数据类的，所以我们选中 Session 来存储验证码数据。</li>
</ul>
<ol start="2">
<li>实现流程分析</li>
</ol>
<p><img data-src="assets/1629452966499.png" alt="1629452966499"></p>
<p>(1) 在 CheckCodeServlet 中生成验证码的时候，将验证码数据存入 Session 对象</p>
<p>(2) 前端将验证码和注册数据提交到后台，交给 RegisterServlet 类</p>
<p>(3) RegisterServlet 类接收到请求和数据后，其中就有验证码，和 Session 中的验证码进行对比</p>
<p>(4) 如果一致，则完成注册，如果不一致，则提示错误信息</p>
<ol start="3">
<li>具体实现</li>
</ol>
<p>(1) 修改 CheckCodeServlet 类，将验证码存入 Session 对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/checkCodeServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckCodeServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成验证码</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> CheckCodeUtil.outputVerifyImage(<span class="number">100</span>, <span class="number">50</span>, os, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 存入Session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        session.setAttribute(<span class="string">&quot;checkCodeGen&quot;</span>,checkCode);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2) 在 RegisterServlet 中，获取页面的和 session 对象中的验证码，进行对比</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/registerServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       <span class="comment">//1. 获取用户名和密码数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取用户输入的验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCode</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;checkCode&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 程序生成的验证码，从Session获取</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">String</span> <span class="variable">checkCodeGen</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;checkCodeGen&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 比对</span></span><br><span class="line">        <span class="keyword">if</span>(!checkCodeGen.equalsIgnoreCase(checkCode))&#123;</span><br><span class="line"></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 不允许注册</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2. 调用service 注册</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> service.register(user);</span><br><span class="line">        <span class="comment">//3. 判断注册成功与否</span></span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">             <span class="comment">//注册功能，跳转登陆页面</span></span><br><span class="line"></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;注册成功，请登录&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/login.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//注册失败，跳转到注册页面</span></span><br><span class="line"></span><br><span class="line">            request.setAttribute(<span class="string">&quot;register_msg&quot;</span>,<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;/register.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，用户的注册登录功能就已经完成了。</p>
<p>(8)</p>

  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2023-01-20 15:35:41" itemprop="dateModified" datetime="2023-01-20T15:35:41+08:00">2023-01-20</time>
  </span>
  <span id="会话技术/" class="item leancloud_visitors" data-flag-title="cookie&session" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="AMANI 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="AMANI 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="AMANI 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>AMANI <i class="ic i-at"><em>@</em></i>диво
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://example.com/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/" title="cookie&amp;session">http://example.com/会话技术/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/computer-science/java/course-1/javaweb/" itemprop="url" rel="prev" data-background-image="&#x2F;assets&#x2F;OIP-C%20(5).jfif" title="javaWeb">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> 零基础学Java语言-浙江大学-翁恺</span>
  <h3>javaWeb</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/Mybatis/" itemprop="url" rel="next" data-background-image="&#x2F;assets&#x2F;%E8%B6%85%E8%B7%91.jpg" title="Mybatis">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Mybatis</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF"><span class="toc-number">1.</span> <span class="toc-text"> 会话技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E4%BC%9A%E8%AF%9D%E8%B7%9F%E8%B8%AA%E6%8A%80%E6%9C%AF%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text"> 1，会话跟踪技术的概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2cookie"><span class="toc-number">3.</span> <span class="toc-text"> 2，Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-cookie%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text"> 2.1 Cookie 的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-cookie%E7%9A%84%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text"> 2.2 Cookie 的原理分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-cookie%E7%9A%84%E4%BD%BF%E7%94%A8%E7%BB%86%E8%8A%82"><span class="toc-number">3.3.</span> <span class="toc-text"> 2.3 Cookie 的使用细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#231-cookie%E7%9A%84%E5%AD%98%E6%B4%BB%E6%97%B6%E9%97%B4"><span class="toc-number">3.3.1.</span> <span class="toc-text"> 2.3.1 Cookie 的存活时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#232-cookie%E5%AD%98%E5%82%A8%E4%B8%AD%E6%96%87"><span class="toc-number">3.3.2.</span> <span class="toc-text"> 2.3.2 Cookie 存储中文</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3session"><span class="toc-number">4.</span> <span class="toc-text"> 3，Session</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-session%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text"> 3.1 Session 的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-session%E7%9A%84%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text"> 3.2 Session 的原理分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-session%E7%9A%84%E4%BD%BF%E7%94%A8%E7%BB%86%E8%8A%82"><span class="toc-number">4.3.</span> <span class="toc-text"> 3.3 Session 的使用细节</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#331-session%E9%92%9D%E5%8C%96%E4%B8%8E%E6%B4%BB%E5%8C%96"><span class="toc-number">4.3.1.</span> <span class="toc-text"> 3.3.1 Session 钝化与活化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#332-session%E9%94%80%E6%AF%81"><span class="toc-number">4.3.2.</span> <span class="toc-text"> 3.3.2 Session 销毁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C%E6%A1%88%E4%BE%8B"><span class="toc-number">5.</span> <span class="toc-text"> 4，用户登录注册案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-number">5.1.</span> <span class="toc-text"> 4.1 需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">5.2.</span> <span class="toc-text"> 4.2 用户登录功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E8%AE%B0%E4%BD%8F%E6%88%91-%E8%AE%BE%E7%BD%AEcookie"><span class="toc-number">5.3.</span> <span class="toc-text"> 4.3 记住我 - 设置 Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-%E8%AE%B0%E4%BD%8F%E6%88%91-%E8%8E%B7%E5%8F%96cookie"><span class="toc-number">5.4.</span> <span class="toc-text"> 4.4 记住我 - 获取 Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">5.5.</span> <span class="toc-text"> 4.5 用户注册功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%E9%AA%8C%E8%AF%81%E7%A0%81-%E5%B1%95%E7%A4%BA"><span class="toc-number">5.6.</span> <span class="toc-text"> 4.6 验证码 - 展示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#47%E9%AA%8C%E8%AF%81%E7%A0%81-%E6%A0%A1%E9%AA%8C"><span class="toc-number">5.7.</span> <span class="toc-text"> 4.7 验证码 - 校验</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="AMANI"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">AMANI</p>
  <div class="description" itemprop="description">在努力提升你喜欢我的概率，即使是从0开始！~~（@ @）~~</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">13</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">3</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">2</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpbi15dWVoZW5n" title="https:&#x2F;&#x2F;github.com&#x2F;lin-yueheng"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly93d3cuZG91eWluLmNvbS91c2VyL01TNHdMakFCQUFBQVJKTEVFVWFyTmo4TjJyeDVsaGFPZHJiZG1PVHBOY3hWYUFjZlpWc2RrV2laWlVsZVpYaC1zWU5yYS0xcm1IeTQ=" title="https:&#x2F;&#x2F;www.douyin.com&#x2F;user&#x2F;MS4wLjABAAAARJLEEUarNj8N2rx5lhaOdrbdmOTpNcxVaAcfZVsdkWiZZUleZXh-sYNra-1rmHy4"><i class="ic i-twitter"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS91aGQtNzU=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;uhd-75"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwMzA2NzI2MzY=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;8030672636"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly9tLndlaWJvLmNuL3Byb2ZpbGUvNzc3NzA2NTQ5Mg==" title="https:&#x2F;&#x2F;m.weibo.cn&#x2F;profile&#x2F;7777065492"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly93d3cuZG91eWluLmNvbS8=" title="https:&#x2F;&#x2F;www.douyin.com&#x2F;"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/computer-science/java/course-1/javaweb/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/Mybatis/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/Mybatis/" title="Mybatis">Mybatis</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a>
<i class="ic i-angle-right"></i>
<a href="/categories/computer-science/java/" title="分类于 Java">Java</a>
<i class="ic i-angle-right"></i>
<a href="/categories/computer-science/java/course-1/" title="分类于 零基础学Java语言-浙江大学-翁恺">零基础学Java语言-浙江大学-翁恺</a>
</div>

    <span><a href="/computer-science/java/course-1/javaweb/" title="javaWeb">javaWeb</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/miniprogram_master/" title="miniprogram_master">miniprogram_master</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/VUE&Element/" title="VUE&amp;Element">VUE&Element</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/JSP/" title="JSP">JSP</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/miniProgram/" title="miniProgram">miniProgram</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/loveIkun-1/" title="loveIkun-1">loveIkun-1</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/%E4%B9%A6%E7%B1%8D-space-1/" title="书籍-space-1">书籍-space-1</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/" title="cookie&amp;session">cookie&session</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/excel-space/" title="excel-space">excel-space</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">AMANI @ 谷阿玛尼</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">262k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">3:58</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '会话技术/',
    favicon: {
      show: "（●´3｀●）やれやれだぜ",
      hide: "(´Д｀)大変だ！"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
